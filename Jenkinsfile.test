elifePipeline {
    stage 'Checkout'
    git branch: 'develop', url: 'git@github.com:elifesciences/lax.git'
    def commit = elifeGitRevision()
 
    stage 'Project tests'
    def testArtifact = "${env.BUILD_TAG}.junit.xml"
    elifeSwitchRevision 'elife-lax-develop-ci', commit
    elifeCmd 'elife-lax-develop-ci', 'cd /srv/lax; ./project_tests.sh || echo TESTS FAILED!'
    elifeTestArtifact testArtifact, 'elife-lax-develop-ci', '/srv/lax/build/junit.xml'
    elifeVerifyJunitXml testArtifact
    
    stage 'End2end tests'
    elifeSwitchRevision 'elife-lax-develop--end2end', commit
    elifeEnd2EndTest()
 
    stage 'Approval'
    elifeGitMoveToBranch commit, 'approved'
}
